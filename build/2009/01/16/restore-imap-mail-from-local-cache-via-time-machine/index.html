<!DOCTYPE html>
<html lang='en'>
  <head>
    <meta charset='utf-8'>
    <meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
    <meta content='width=device-width, initial-scale=1.0' name='viewport'>
    <meta content='Ruby enthusiasts, mostly based in Kansas City, KS, USA.' name='description'>
    <title>Restore IMAP mail from local cache via Time Machine</title>
    <link href="/stylesheets/all.css" rel="stylesheet" />
    <link href="//netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css" rel="stylesheet">
    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="/javascripts/all.js"></script>
    <link href="//cdn-images.mailchimp.com/embedcode/classic-10_7.css" rel="stylesheet" type="text/css">
    <style type="text/css">
      #mc_embed_signup{background:#fff; clear:left; font:14px Helvetica,Arial,sans-serif; }
      /* Add your own MailChimp form style overrides in your site stylesheet or in this style block.
         We recommend moving this block and the preceding CSS link to the HEAD of your HTML file. */
    </style>
  </head>
</html>
<nav class='navbar navbar-default'>
  <div class='container-fluid'>
    <div class='navbar-header'>
      <button class='navbar-toggle collapsed' data-target='#bs-example-navbar-collapse-1' data-toggle='collapse' type='button'>
        <span class='sr-only'>Toggle navigation</span>
        <span class='icon-bar'></span>
        <span class='icon-bar'></span>
        <span class='icon-bar'></span>
      </button>
      <a class='navbar-brand' href='/'>
        <img alt='logo' height='42px' src='/images/databasically-square.png'>
      </a>
    </div>
    <div class='collapse navbar-collapse' id='bs-example-navbar-collapse-1'>
      <ul class='nav navbar-nav'>
        <li>
          <a href='/contact'>
            Contact
            <span class='sr-only'>(current)</span>
          </a>
        </li>
        <li>
          <a href='/articles'>Articles</a>
        </li>
        <li>
          <a href='/railsconf2016'>Railsconf 2016 Events</a>
        </li>
      </ul>
      <form action='https://duckduckgo.com/' class='navbar-form navbar-right' method='get' role='search'>
        <div class='form-group'>
          <input name='ki' type='hidden' value='-1'>
          <input name='ke' type='hidden' value='-1'>
          <input name='kz' type='hidden' value='-1'>
          <input name='kj' type='hidden' value='#CB4D51'>
          <input name='k9' type='hidden' value='#CB4D51'>
          <input name='k8' type='hidden' value='#000000'>
          <input name='kh' type='hidden' value='+1'>
          <input name='sites' type='hidden' value='www.databasically.com'>
          <input class='form-control' name='q' placeholder='Search this site' type='text'>
          <button class='btn btn-default' type='submit'>
            <span class='glyphicon glyphicon-search'></span>
          </button>
        </div>
      </form>
    </div>
  </div>
</nav>
<body>
  <div class='container'>
    <div class='row'>
      <div class='span12 article'>
        <h1>Restore IMAP mail from local cache via Time Machine</h1>
        <h3 class='muted pull-right post_date'>
          Jan 16 2009
        </h3>
        I had a real scary moment last night.  I was cleaning off my server and deleted the home directory for my databasically email account. I don't host the website on that server, so I thought removing the home directory would be fine.  However, I do host the mail on that server and it's stored in the home directory.
        <br><br>
        I had Apple Mail.app running and connected to that mailbox.  I didn't really notice it until a few minutes later when a message came in on another account.
        <br><br>
        My work account was blank.  Empty. Also, I had a nice exclamation point saying the account couldn't be found.
        <br><br>
        Whoops.  Oh hell.
        <br><br>
        I have my computer hooked to an external hard drive which I'm using as my Time Machine (the built-in Mac backup software) drive.  I poked through the folders from an hour ago and found all my mail.
        <br><br>
        The mail is stored in ~/Library/Mail/, where each IMAP account has a folder called <strong>IMAP-user@host</strong>. This folder contains many folders with the .imapmbox extension.
        <br><br>
        Here's how I restored my mailbox:
        <ul>
        	<li>Recreated my home directory and made sure that the email address still worked.  You may want to set up a new account if you're moving hosts or whatever.  Get a working IMAP account up and running.</li>
        	<li>Put the IMAP-user@host folder to my Desktop.  Actually, I restored it from Time Machine and then copied it to the Desktop. I selected "Keep both" when doing the Time Machine restore which renamed my existing folder to end in "(original)".  I moved the restored folder to my Desktop and removed the "(original)".</li>
        	<li>Renamed each folders' extension from <strong>.imapmbox</strong> to <strong>.mbox</strong> . Make sure you get any subfolders as well.</li>
        	<li>Import the file:  File &gt; Import Mailboxes &gt; Mail for Mac OS X</li>
        	<li>Select the parent folder (IMAP-user@host) containing all your .mbox files.</li>
        	<li>Your mail will be imported to a folder named <strong>Import</strong> inside the On My Mac folder.</li>
        	<li>Drag your mail to your new/restored IMAP mailbox.  I copied 5000 messages at a time without an issue.</li>
        </ul>
        Hopefully you never need this information.
        <br><br>
        If it helped you out or if you have any other information, please let me know in the comments.
      </div>
    </div>
  </div>
  <div class='container'>
    <div class='row'>
      <blockquote class='blockquote-reverse'>
        <p>
          Established 2005 &middot; Databasically &copy;
          2016
        </p>
      </blockquote>
    </div>
    <div class='row'>
      <p class='small pull-right'>
        <a href="/sitemap.xml">sitemap</a>
      </p>
    </div>
  </div>
  <script>
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-2626511-3']);
    _gaq.push(['_setDomainName', 'databasically.com']);
    _gaq.push(['_trackPageview']);
    
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>
</body>
